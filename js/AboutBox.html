<!--
MazeWars VR
Copyright (C) 2016 Marcio Teixeira

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU Affero General Public License
as published by the Free Software Foundation; either version 3
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<template id="AboutBoxTemplate">
    <style>
        .darken {
            background:      rgba(0,0,0,0.8);
            color:           lightGray;
        }

        /* Break up the screen into three stacked regions */

        .flex-layout {
            display:         -ms-flex;
            display:         -webkit-flex;
            display:         flex;

            flex-direction:  column;
            align-items:     center;
        }

        .header {
            width:       100%;
            flex-grow:   0;
            flex-shrink: 1;
            height:      25%;
        }

        .footer {
            width:       100%;
            flex-grow:   0;
            flex-shrink: 1;
            height:      15%;
        }

        .middle {
            flex-grow:      1;
            flex-shrink:    0;
            width:          80%;
            height:         60%;
        }

        /* A dynamically sized grid */

        .flex-grid {
            display:        -ms-flex;
            display:        -webkit-flex;
            display:        flex;

            flex-direction: column;
            align-items:    center;
            flex-wrap:      wrap;
        }

        .flex-grid > div {
            padding:    10px;
            box-sizing: border-box;
            position:   relative;
            flex-grow:  1;
        }

        @media (orientation: landscape) {
            .flex-grid > div {
                width:  50%;
            }

            .flex-grid.six-element > div {
                height: 33%;
            }

            .flex-grid.four-element > div {
                height: 50%;
            }

            .flex-grid.two-element > div {
                height: 49%;
                width:  100%;
            }

            .grid-button, .centered-button {
                font-size:   7vh;
            }

            h1.title {
                font-size: 10vh;
            }
        }

        @media (orientation: portrait) {
            .flex-grid > div {
                width:  100%;
            }

            .flex-grid.six-element > div {
                height: 16%;
            }

            .flex-grid.four-element > div {
                height: 24%;
            }

            .flex-grid.two-element > div {
                height: 49%;
            }

            .grid-button, .centered-button {
                font-size:   7vw;
            }

            h1.title {
                font-size: 10vw;
            }
        }

        /* Distribute DIVs vertically */

        .flex-distribute {
            display:         -ms-flex;
            display:         -webkit-flex;
            display:         flex;

            flex-direction:  column;

            min-height:      100%;
        }

        .flex-distribute > div {
            flex-grow:  1;
        }

        .flex-distribute > div:last-child {
            padding-bottom: 2em;
        }

        /* A button */

        .grid-button {
            position:   absolute;
            top:        10px;
            bottom:     10px;
            right:      10px;
            left:       10px;

            min-height: 2em;
            padding:    3px;
        }

        .center-text, .grid-button {
            display:        -ms-flex;
            display:        -webkit-flex;
            display:        flex;

            justify-content: center;
            align-items:     center;
            text-align:      center;
        }

        .hidden {
            display: none;
        }

        /* The overlay */

        #overlay {
            position:      fixed;
            top:           0;
            bottom:        0;
            left:          0;
            right:         0;

            font-family:   "Gill Sans", "Gill Sans MT", Calibri, sans-serif;
        }

        .header {
            padding: 1em;
        }

        .clickable {
            font-weight: bold;
            color:       rgb(255,255,128);
            text-shadow: 5px 5px rgba(0,0,0,0.5);

            cursor:      pointer;
        }

        .clickable:active, .clickable:hover {
            color:       rgb(255,255,192);
            text-shadow: 5px 5px rgba(255,255,128,0.25);

            -webkit-text-stroke: 2px rgb(255,255,192);
            -webkit-text-fill-color: rgb(64,64,32);
        }

        h1.title {
            color: white;
            text-align: center;
        }

        h1, h2, h3, h4, h5, h6, strong {
            color:       white;
        }

        h1.title strong {
            color: yellow;
        }

        h1, h2, h3, h4, h5, h6 {
            text-shadow: 5px 5px rgba(0,0,0,0.5);
        }

        svg {
            height: 25%;
            width:  25%;
        }

        svg path {
            fill: rgb(255,255,128);
        }

        svg:hover path {
            fill: rgb(255,255,192);
        }

        DIV#mode-select P {
            display:         -ms-flex;
            display:         -webkit-flex;
            display:         flex;

            flex-direction:  row;
            justify-content: space-around;
            align-items:     center;
            width:           100%;
        }

        @media (orientation: portrait) {
            .side-by-side {
                display:         -ms-flex;
                display:         -webkit-flex;
                display:         flex;

                align-items:     center;
                width:           100%;
                flex-direction:  column;
            }

            .side-by-side IMG {
                display:       block;
                width:         50%;
                height:        50%;
            }
        }

        @media (orientation: landscape) {
            .side-by-side {
                display:         -ms-flex;
                display:         -webkit-flex;
                display:         flex;

                justify-content: space-around;
                align-items:     center;
                width:           100%;
                flex-direction:  row;
            }

            .side-by-side IMG {
                display:       block;
                width:         30%;
                height:        30%;
            }
        }

        DIV.associate-links {
            padding:         1em 0;
            text-align:      center;
        }

        DIV.associate-links SPAN {
            font-size:       150%;
        }

        A {
            color:           rgb(255,255,128);
        }

        .swipe-arrow::before {
            color: rgba(255,255,128, 0.5);
        }

        /* Emulator page */

        #pageAltoMazeWar {
            padding:    0 0 !important;
            background: black;
        }

        alto-emulator {
            position:   absolute;
            top:        0;
            bottom:     0;
            margin:     0 0;
        }

        alto-emulator canvas {
            padding:    0 0;
            margin:     0 auto;
            max-height: 100%;
            max-width:  100%;
        }

        .altoHelp {
            display:        none;

            background:     rgba(0,0,0,0.85);
            text-align:     center;

            position:       absolute;
            bottom:         0;
            left:           0;
            right:          0;

            padding:        5px;
        }

        /* Prevent font scaling in landscape while allowing user zoom
            http://stackoverflow.com/questions/2710764/preserve-html-font-size-when-iphone-orientation-changes-from-portrait-to-landsca
         */
        html {
            -webkit-text-size-adjust: 100%;
        }

        @media (orientation: landscape) {
            img.float {
                float: right;
                height: 25vw;
                padding: 1em;
            }
        }

        @media (orientation: portrait) {
            img.float {
                display: block;
                height: 20vh;
                padding: 0.5em;
                margin: 0 auto;
            }
        }
    </style>
    <div class="darken" id="overlay">
    <swipe-pages>
        <div class="flex-layout" id="page1">
            <div class="header center-text">
                <h1 class="title">Maze War <strong>VR</strong></h1>
            </div>
            <div class="middle flex-grid six-element">
                <div><div class="clickable grid-button" data-page="pageAbout">History &amp; Help</div></div>
                <div><div class="clickable grid-button" id="playSolo">Play Solo</div></div>
                <div><div class="clickable grid-button" data-page="pageNetPlay">Play with Friends</div></div>
                <div><div class="clickable grid-button" data-page="pageOptions">VR Options</div></div>
                <div><div class="clickable grid-button" data-page="pageCredits">Credits</div></div>
                <div><div class="clickable grid-button" data-page="pageHeadsets">Recommended Headsets</div></div>
            </div>
            <div class="footer">
            </div>
        </div>

        <div class="flex-layout" id="pageNetPlay">
            <div class="header center-text">
                <h1 class="title">Play with Friends</h1>
            </div>
            <div class="middle flex-grid two-element">
                <div><div class="clickable grid-button" id="inviteFriends">Invite Friends</div></div>
                <div><div class="clickable grid-button" id="startNetworkGame">Start Game</div></div>
            </div>
            <div class="footer">
            </div>
        </div>

        <div class="flex-distribute" id="pageAbout">
            <div>
                <h1>History of Maze War</h1>
                <p>
                <cite>Maze War VR</cite> is a remake of the game written by Steve Colley and Greg Thompson in 1974 at the NASA Ames Research Center in California. Players would hunt down opponents in a three-dimensional maze, making it the grandfather of first person shooter games.
                By 1977, the game was taken to MIT, where it was played on the early computer networks of the time.
                </p>
                <h1>How to Play</h1>
                <p>
                    This remake can be played either using a VR headset or without. Select "Display Options" to choose the VR mode.
                </p>
                <p>
                <strong>Headset Controls:</strong> Hold down the trigger on your headset to move in the direction you are facing; press and release
                the trigger rapidly to shoot.
                </p>
                <p>
                <strong>Smartphone or Tablet Controls:</strong>
                Move the device to look around, hold your finger anywhere on the screen to move in the direction you are facing; tap to shoot.
                </p>
                <strong>Desktop Controls:</strong>
                Move the mouse to look around, hold down the mouse button to move in the direction you are facing; click rapidly to shoot.
                </p>
            </div>
        </div>

        <div class="flex-distribute" id="pageCredits">
            <div>
                <h1>Credits</h1>
                <p>
                This game may include source code from:
                <ul>
                <li><a href="https://threejs.org/">THREE.js</a>
                <li><a href="http://webcomponents.org">Webcomponents.org</a>
                <li><a href="https://github.com/chenglou/tween-functions">Tween-Functions</a>
                <li><a href="http://peerjs.com">Peerjs.com</a>
                <li><a href="http://www.yorgsite.fr/experiments/YConsole/">YConsole</a>
                <li><a href="https://github.com/eface2face/cordova-plugin-iosrtc">cordova-plugin-iosrtc</a>
                </ul>
                Complete source code and licenses are available on <a href="https://github.com/marciot/mazewar-vr">GitHub</a>.
                </p>
            </div>
            <div>
                <center>
                <div class="page-link clickable centered-button" data-page="pageInspiration">Next</div>
                </center>
            </div>
        </div>

        <div class="flex-distribute" id="pageInspiration">
            <div>
                <h1>The Inspiration:</h1>
                <img src="artwork/mazewar-alto.png" class="float">
                <p>
                This remake was inspired by the Xerox Alto version of Maze War which was developed in 1977 at MIT and was itself a remake
                of the 1974 version developed at NASA.
                </p>
                <p>
                A playable demo of the original is made possible by:
                <ul>
                <li><a href="https://github.com/livingcomputermuseum/ContrAlto">Contralto</a> from <a href="http://www.livingcomputers.org">Living
                Computers: Museum + Labs</a>
                <li><a href="http://www.loomcom.com/contraltojs/">ContraltoJS</a> from <a href="http://www.loomcom.com">loomcom.com</a>
                <li>The Xerox Alto preservation efforts of <a href="http://bitsavers.org">Bitsavers.org</a>
                </ul>
                </p>
            </div>
            <div>
                <center>
                <div id="altoLink" class="clickable centered-button" data-page="pageAltoMazeWar">Play the Alto Version!</div>
                </center>
            </div>
        </div>

        <div class="flex-distribute" id="pageOptions">
            <div>
                <h1>Select your VR Experience:</h1>
                <p>
                The best way to play <cite>Maze War VR</cite> is using a modern smartphone and a VR headset. However, you may also play on a PC, tablet or smartphone without a headset&mdash;either in 3D using red/cyan glasses or in 2D without.
                </p>
                <div id="mode-select">
                    <p>
                    <svg id="headset" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 63 58.75" enable-background="new 0 0 63 47" xml:space="preserve"><line x1="87.4" y1="37.2" x2="97.2" y2="37.2"/><g><path d="M42.9,20c-3.4,0-6.2,2.8-6.2,6.2s2.8,6.2,6.2,6.2s6.2-2.8,6.2-6.2S46.4,20,42.9,20z M42.9,31.5c-2.9,0-5.2-2.4-5.2-5.2   S40,21,42.9,21s5.2,2.4,5.2,5.2S45.8,31.5,42.9,31.5z"/><path d="M20.9,20c-3.4,0-6.2,2.8-6.2,6.2s2.8,6.2,6.2,6.2s6.2-2.8,6.2-6.2S24.4,20,20.9,20z M20.9,31.5c-2.9,0-5.2-2.4-5.2-5.2   S18,21,20.9,21s5.2,2.4,5.2,5.2S23.8,31.5,20.9,31.5z"/><path d="M55.7,9V7.9c0-1.6-1.3-2.9-2.9-2.9H11.3C9.7,5,8.4,6.3,8.4,7.9V9c-2.3,0.7-4,2.8-4,5.3v22.6c0,3,2.5,5.5,5.5,5.5h13.4   c1.8,0,3.4-1,4.1-2.6c0,0,0-0.1,0-0.1l0.2-0.5h8l0.1,0.4c0,0,0,0.1,0,0.1c0.7,1.7,2.3,2.8,4.2,2.8h13.9c3,0,5.5-2.5,5.5-5.5V14.3   C59.4,11.8,57.8,9.8,55.7,9z M10.7,7.9c0-0.3,0.3-0.6,0.6-0.6h41.4c0.3,0,0.6,0.3,0.6,0.6v2H10.7V7.9z M27.3,36.7l2-5   c0.5-1,1.4-1.6,2.5-1.6c0.9,0,2.1,0.5,2.6,1.7l1.7,4.9H27.3z M57.2,36.9c0,1.8-1.5,3.2-3.2,3.2H40c-0.9,0-1.7-0.5-2.1-1.4l-2.6-7.3   c-0.6-1.4-1.9-2.3-3.5-2.3c-1.5,0-2.8,0.8-3.4,2.2l-3,7.5c-0.4,0.8-1.2,1.3-2.1,1.3H9.9c-1.8,0-3.2-1.5-3.2-3.2V14.3   c0-1.8,1.5-3.2,3.2-3.2h44c1.8,0,3.2,1.5,3.2,3.2V36.9z"/></g></svg>
                    <svg id="anaglyph" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" x="0px" y="0px" viewBox="0 0 146 158.75" enable-background="new 0 0 146 127" xml:space="preserve"><g><path d="M68.5,18H78c0.6,0,1-0.4,1-1s-0.4-1-1-1h-9.5c-0.6,0-1,0.4-1,1S67.9,18,68.5,18z"/><path d="M121,21H25c-2.2,0-4,1.8-4,4v57c0,2.2,1.8,4,4,4h96c2.2,0,4-1.8,4-4V25C125,22.8,123.2,21,121,21z M123,82c0,1.1-0.9,2-2,2   H25c-1.1,0-2-0.9-2-2V25c0-1.1,0.9-2,2-2h96c1.1,0,2,0.9,2,2V82z"/></g><path d="M125,9H21c-5.5,0-10,4.5-10,10v68c0,5.5,4.5,10,10,10h37v9l-7.5,5.2c-1.5,1.1-2.5,2.5-1.8,4.9c0.7,2.3,2.4,3,4.3,3h40  c1.9,0,3.6-0.6,4.3-3c0.7-2.3-0.3-3.8-1.8-4.8l-7.5-5.3l0-8.9h37c5.5,0,10-4.5,10-10V19C135,13.5,130.5,9,125,9z M93.2,114.5  c0.5,0.3,0.4,0.6-0.2,0.6H53c-0.5,0-0.6-0.3-0.2-0.6l8-5.6h17.7c0.6,0,1-0.4,1-1v-0.2c0-0.6-0.4-1-1-1H62V95h22v12  c0,0.6,0.3,1.2,0.8,1.5L93.2,114.5z M131,87c0,3.3-2.7,6-6,6H88h-4H62h-4H21c-3.3,0-6-2.7-6-6V19c0-3.3,2.7-6,6-6h104  c3.3,0,6,2.7,6,6V87z"/><path d="m 41.3,40.2 c -2.4,0 -4.3,1.9 -4.3,4.3 l 0,17.1 c 0,2.4 1.9,4.3 4.3,4.3 l 21.4,0 c 1,0 1.9,-0.3 2.6,-0.9 l 6.4,-5 c 0.2,-0.1 0.2,-0.1 0.5,-0.2 0.6,-0.2 1.4,-0.3 1.2,-0.3 -0.2,0 0.5,0.1 1,0.3 0.3,0.1 0.3,0.1 0.5,0.2 l 6.6,5.1 c 0.7,0.6 1.7,0.9 2.6,0.9 l 21.4,0 c 2.4,0 4.3,-1.9 4.3,-4.3 l 0,-17.1 c 0,-2.4 -1.9,-4.3 -4.3,-4.3 z" /><path d="m 44.2,45.9 c -1,0 -1.8,0.8 -1.8,1.8 l 0,10.7 c 0,1 0.8,1.8 1.8,1.8 l 17.4,0 c 1,0 1.8,-0.8 1.8,-1.8 l 0,-10.7 c 0,-1 -0.8,-1.8 -1.8,-1.8 z" style="fill: darkRed;"/><path d="m 85.2,45.9 c -1,0 -1.8,0.8 -1.8,1.8 l 0,10.7 c 0,1 0.8,1.8 1.8,1.8 l 17.4,0 c 1,0 1.8,-0.8 1.8,-1.8 l 0,-10.7 c 0,-1 -0.8,-1.8 -1.8,-1.8 z" style="fill: darkCyan;"/></svg>
                    <svg id="monitor" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" x="0px" y="0px" viewBox="0 0 146 158.75" enable-background="new 0 0 146 127" xml:space="preserve"><g><path d="M68.5,18H78c0.6,0,1-0.4,1-1s-0.4-1-1-1h-9.5c-0.6,0-1,0.4-1,1S67.9,18,68.5,18z"/><path d="M121,21H25c-2.2,0-4,1.8-4,4v57c0,2.2,1.8,4,4,4h96c2.2,0,4-1.8,4-4V25C125,22.8,123.2,21,121,21z M123,82c0,1.1-0.9,2-2,2   H25c-1.1,0-2-0.9-2-2V25c0-1.1,0.9-2,2-2h96c1.1,0,2,0.9,2,2V82z"/></g><path d="M125,9H21c-5.5,0-10,4.5-10,10v68c0,5.5,4.5,10,10,10h37v9l-7.5,5.2c-1.5,1.1-2.5,2.5-1.8,4.9c0.7,2.3,2.4,3,4.3,3h40  c1.9,0,3.6-0.6,4.3-3c0.7-2.3-0.3-3.8-1.8-4.8l-7.5-5.3l0-8.9h37c5.5,0,10-4.5,10-10V19C135,13.5,130.5,9,125,9z M93.2,114.5  c0.5,0.3,0.4,0.6-0.2,0.6H53c-0.5,0-0.6-0.3-0.2-0.6l8-5.6h17.7c0.6,0,1-0.4,1-1v-0.2c0-0.6-0.4-1-1-1H62V95h22v12  c0,0.6,0.3,1.2,0.8,1.5L93.2,114.5z M131,87c0,3.3-2.7,6-6,6H88h-4H62h-4H21c-3.3,0-6-2.7-6-6V19c0-3.3,2.7-6,6-6h104  c3.3,0,6,2.7,6,6V87z"/></svg>
                    </p>
                    <p>
                    Icons by Nick Bluth from the Noun Project
                    </p>
                </div>
            </div>
        </div>

        <div class="flex-distribute" id="pageHeadsets">
            <div>
                <h1>Recommended VR Headset</h1>
                I recommend the <cite>Mattel ViewMaster VR</cite> for the best <cite>Maze War VR</cite> experience. It is inexpensive, works with most phones and has a responsive trigger that works great with <cite>Maze War VR</cite>.

                <div class="side-by-side">
                    <img src="artwork/viewmaster.png">

                    <div class="associate-links">
                        <a href="https://www.amazon.com/gp/product/B011EG5HJ2/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B011EG5HJ2&linkCode=as2&tag=marciot-20&linkId=5bb5f23b398d2640a6191d9ef6e39e58 target="_blank">
                        <span><cite>View-Master VR Starter Pack</cite></span>
                        </a>
                        <p>or</p>
                        <a href="https://www.amazon.com/gp/product/B01CNSO79Q/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B01CNSO79Q&linkCode=as2&tag=marciot-20&linkId=4cbc30bb928aa42d2d028106a56cb072" target="_blank">
                        <span><cite>Deluxe View-Master VR Viewer</cite></span>
                        </a>
                        <br>at amazon.com
                    </div>
                </div>
                <img src="//ir-na.amazon-adsystem.com/e/ir?t=marciot-20&l=am2&o=1&a=B011EG5HJ2" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
            </div>
            <div>
                <h2>Will my Google Cardboard viewer work?</h2>

                The first generation Google Cardboard with a magnetic switch will not work, as <cite>Maze War VR</cite> requires a mechanical touch switch.
            </div>
        </div>

        <div id="pageAltoMazeWar">
            <alto-emulator>
            </alto-emulator>
            <div class="altoHelp" id="altoHelp1">
                Starting up.
            </div>
            <div class="altoHelp" id="altoHelp2">
                Keep waiting. I'll say when.
            </div>
            <div class="altoHelp" id="altoHelp3">
                Type "mazewar"
            </div>
            <div class="altoHelp" id="altoHelp4">
                ...followed by ENTER
            </div>
            <div class="altoHelp" id="altoHelp5">
                You're on your own now.
            </div>
            <div class="altoHelp" id="altoHelp6">
                Leave the duke host blank.
            </div>
            <div class="altoHelp" id="altoHelp7">
                Something's happening...
            </div>
            <div class="altoHelp" id="altoHelp8">
                Searching for network players.
            </div>
            <div class="altoHelp" id="altoHelp9">
                This takes a while.
            </div>
            <div class="altoHelp" id="altoHelp10">
                A bloody long while.
            </div>
            <div class="altoHelp" id="altoHelp11">
                Type D to move forwards.
            </div>
            <div class="altoHelp" id="altoHelp12">
                Type S or F to turn left or right.
            </div>
            <div class="altoHelp" id="altoHelp13">
                Type A to do an about face.
            </div>
            <div class="altoHelp" id="altoHelp14">
                Click the mouse to shoot an opponent.
            </div>
        <div>
    </swipe-pages>
    </div>
</template>

<script>
(function (thisDoc) {
    var AboutBoxProto = Object.create(HTMLElement.prototype);

    AboutBoxProto.createdCallback = function() {
        var t = thisDoc.getElementById('AboutBoxTemplate');
        var clone = document.importNode(t.content, true);
        //var shadowRoot = this.createShadowRoot();
        var shadowRoot = this;
        shadowRoot.appendChild(clone);

        function selectExperience(mode) {
            this.dispatchCallback("gfxModeSelected", mode);
            swipePages.gotoPage("page1");
        }

        shadowRoot.querySelector("#headset").addEventListener("click", selectExperience.bind(this, "headset"));
        shadowRoot.querySelector("#monitor").addEventListener("click", selectExperience.bind(this, "monitor"));
        shadowRoot.querySelector("#anaglyph").addEventListener("click", selectExperience.bind(this, "anaglyph"));

        function startSoloGame() {
            shadowRoot.querySelector("#overlay").style.display = "none";
            shadowRoot.dispatchCallback("startSoloGame");
        }
        shadowRoot.querySelector("#playSolo").addEventListener("click", startSoloGame);

        function startNetworkGame() {
            shadowRoot.querySelector("#overlay").style.display = "none";
            shadowRoot.dispatchCallback("startNetworkGame");
        }
        shadowRoot.querySelector("#startNetworkGame").addEventListener("click", startNetworkGame);

        var swipePages    = shadowRoot.querySelector("swipe-pages");
        var emulator      = shadowRoot.querySelector("alto-emulator");
        var altoStartHelp = shadowRoot.querySelector("#altoStartHelp");
        var altoKeyHelp   = shadowRoot.querySelector("#altoKeyHelp");

        swipePages.bindElements(shadowRoot.querySelectorAll(".page-link"));
        swipePages.bindElements(shadowRoot.querySelectorAll(".grid-button"));

        shadowRoot.querySelector("#altoLink").addEventListener("click",
            function(e) {
                e.preventDefault();
                e.stopPropagation();
                swipePages.followLink(e.target);
                emulator.startEmulator();
                altoHelper.start();
            }
        );

        var altoHelper = new function() {
            var enterPressed    = 0;
            var gameKeysPressed = 0;
            var currentState    = 0;
            var currentTip      = 0;

            var stateTransitions = [
                {packetCount: 0,  enterCount: 0, gameKeyCount: 0},
                {packetCount: 3,  enterCount: 0, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 0, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 0, gameKeyCount: 1},
                {packetCount: 6,  enterCount: 1, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 2, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 3, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 3, gameKeyCount: 0, delay: 3000},
                {packetCount: 10, enterCount: 3, gameKeyCount: 0},
                {packetCount: 17, enterCount: 3, gameKeyCount: 0},
                {packetCount: 17, enterCount: 3, gameKeyCount: 0, delay: 22000},
                {packetCount: 17, enterCount: 3, gameKeyCount: 1, delay: 3000},
                {packetCount: 17, enterCount: 3, gameKeyCount: 1, delay: 3000},
                {packetCount: 17, enterCount: 3, gameKeyCount: 1, delay: 3000},
                {packetCount: 17, enterCount: 3, gameKeyCount: 1, delay: 3000}
            ];

            this.checkState = function() {
                if(currentState === stateTransitions.length) {
                    clearInterval(this.timer);
                    return;
                }
                var state = stateTransitions[currentState];
                if((ethernetController.packetsSent >= state.packetCount) &&
                   (enterPressed                  >= state.enterCount)  &&
                   (gameKeysPressed               >= state.gameKeyCount))
                {
                    currentState++;
                    gameKeysPressed = 0;
                    showTip(currentState, state.delay);
                }
            }

            function showTip(which, delayBefore) {
                if(delayBefore) {
                    setTimeout(showTip, delayBefore, which);
                    return;
                }
                var cur = shadowRoot.querySelector("#altoHelp" + currentTip);
                var next = shadowRoot.querySelector("#altoHelp" + which);
                if(cur) {
                    cur.style.display = "none";
                }
                if(next) {
                    next.style.display = "block";
                    currentTip = which;
                }
            }

            this.keyHandler = function(event) {
                switch (event.key) {
                    case "Enter":
                        enterPressed++;
                        break;
                    case "a":
                    case "s":
                    case "d":
                    case "f":
                    case "g":
                        gameKeysPressed++;
                }
                this.checkState();
            };

            this.start = function() {
                this.timer = setInterval(this.checkState.bind(this), 1000);
            };
        }

        this.eventListeners = {
            gfxModeSelected:  [],
            startSoloGame:    [],
            startNetworkGame: []
        };

        var altoDisplay = shadowRoot.querySelector("#altoDisplay");
        var altoInput = shadowRoot.querySelector("#altoTextArea");
        if(altoDisplay) {
            altoDisplay.addEventListener("keydown", altoHelper.keyHandler.bind(altoHelper));
            altoDisplay.addEventListener("click",   altoInput.focus.bind(altoInput));
        }

        // Facebook share
        function shareInviteOnFacebook(e) {
            e.preventDefault();
            e.stopPropagation();
            if(typeof FB !== "undefined") {
                FB.ui({
                    method: 'share',
                    mobile_iframe: true,
                    href: 'http://www.marciot.com/mazewar-vr',
                }, function(response){});
            }
        }
        shadowRoot.querySelector("#inviteFriends").addEventListener("click", shareInviteOnFacebook);
    };

    AboutBoxProto.addCallback = function(eventStr, callback) {
        this.eventListeners[eventStr].push(callback);
    }

    AboutBoxProto.dispatchCallback = function(eventStr, ...args) {
        for(var i = 0; i < this.eventListeners[eventStr].length; i++) {
            this.eventListeners[eventStr][i].apply(null, args);
        }
    }

    var AboutBox = document.registerElement('about-box', {prototype: AboutBoxProto});
})((document._currentScript || document.currentScript).ownerDocument);
</script>