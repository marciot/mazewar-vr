<!--
MazeWars VR
Copyright (C) 2016 Marcio Teixeira

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU Affero General Public License
as published by the Free Software Foundation; either version 3
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<template id="AboutBoxTemplate">
    <style>
        .darken {
            background:      rgba(0,0,0,0.8);
            color:           lightGray;
        }

        /* Break up the screen into three stacked regions */

        .flex-layout {
            display: flex;
            flex-direction:  column;
            align-items:     center;
        }

        .header {
            width:      100%;
            flex:       0 1 25%;
        }

        .footer {
            width:      100%;
            flex:       0 1 15%;
        }

        .middle {
            width:      80%;
            height:     60%;
            flex:       1 0 60%;
        }

        /* A dynamically sized grid */

        .flex-grid {
            display:        flex;
            flex-direction: column;
            align-items:    stretch;
            flex-wrap:      wrap;

            /* Fallback: */
            margin:     0 auto;
        }

        .flex-grid > div {
            padding:    10px;
            box-sizing: border-box;
            position:   relative;
            flex-grow:  1;
        }

        @media (orientation: landscape) {
            .flex-grid > div {
                width:  50%;
            }

            .flex-grid.six-element > div {
                flex:       0 1 32%;
                max-height: 32%;
            }

            .flex-grid.four-element > div {
                flex:       0 1 50%;
                max-height: 50%;
            }

            .flex-grid.three-element > div {
                flex:       0 1 32%;
                max-height: 32%;
                width:  100%;
            }

            .flex-grid.two-element > div {
                flex:       0 1 49%;
                max-height: 49%;
                width:      100%;
            }

            .button {
                font-size:  7vh;
            }

            input {
                font-size:  6vh;
            }

            .header h1 {
                font-size:  10vh;
            }
        }

        @media (orientation: portrait) {
            .flex-grid > div {
                width:  100%;
            }

            .flex-grid.six-element > div {
                flex:       0 1 16%;
                max-height: 16%;
            }

            .flex-grid.four-element > div {
                flex:       0 1 24%;
                max-height: 24%;
            }

            .flex-grid.three-element > div {
                flex:       0 1 32%;
                max-height: 32%;
            }

            .flex-grid.two-element > div {
                flex:       0 1 49%;
                max-height: 49%;
            }

            .button {
                font-size:  7vw;
            }

            input {
                font-size:  6vw;
            }

            h1.title {
                font-size:  10vw;
            }
        }

        /* Distribute DIVs vertically */

        .flex-distribute {
            display:         flex;

            flex-direction:  column;

            min-height:      100%;
        }

        .flex-distribute > div {
            flex-grow:  1;
        }

        .flex-distribute > div:last-child {
            padding-bottom: 2em;
        }

        /* A button */

        .button {
            font-weight: bold;
            color:       rgb(255,255,128);
            text-shadow: 5px 5px rgba(0,0,0,0.5);
            text-align:  center;
            cursor:      pointer;
        }

        .button:active, .button:hover {
            color:       rgb(255,255,192);
            text-shadow: 5px 5px rgba(255,255,128,0.25);

            -webkit-text-stroke: 2px rgb(255,255,192);
            -webkit-text-fill-color: rgb(64,64,32);
        }

        .side-by-side .button {
            display: inline-block;
        }

        .hidden {
            display: none;
        }

        input {
            color:            rgb(255,255,128);
            border:           none;
            background-color: transparent;
        }

        /* The overlay */

        #overlay {
            position:      fixed;
            top:           0;
            bottom:        0;
            left:          0;
            right:         0;

            font-family:   "Gill Sans", "Gill Sans MT", Calibri, sans-serif;
        }

        .header h1 {
            color: white;
            text-align: center;
        }

        h1, h2, h3, h4, h5, h6, strong {
            color:       white;
        }

        .header h1 strong {
            color: yellow;
        }

        h1, h2, h3, h4, h5, h6 {
            text-shadow: 5px 5px rgba(0,0,0,0.5);
        }

        @media (orientation: portrait) {
            svg {
                width:  20vw;
            }
        }

        @media (orientation: landscape) {
            svg {
                width:  20vh;
            }
        }

        svg {
            cursor: pointer;
        }

        svg path {
            fill: rgb(255,255,128);
        }

        svg:hover path {
            fill: rgb(255,255,192);
        }

        DIV#mode-select P {
            display:         -ms-flex;
            display:         -webkit-flex;
            display:         flex;

            flex-direction:  row;
            justify-content: space-around;
            align-items:     center;
            width:           100%;
        }

        @media (orientation: portrait) {
            .side-by-side {
                display:         -ms-flex;
                display:         -webkit-flex;
                display:         flex;

                align-items:     center;
                width:           100%;
                flex-direction:  column;
            }

            .side-by-side IMG {
                display:       block;
                width:         50%;
                height:        50%;
            }
        }

        @media (orientation: landscape) {
            .side-by-side {
                display:         -ms-flex;
                display:         -webkit-flex;
                display:         flex;

                justify-content: space-around;
                align-items:     center;
                width:           100%;
                flex-direction:  row;
            }

            .side-by-side IMG {
                display:       block;
                width:         30%;
                height:        30%;
            }
        }

        .side-by-side.align-top {
            align-items:     flex-start;
        }

        DIV.associate-links {
            padding:         1em 0;
            text-align:      center;
        }

        DIV.associate-links SPAN {
            font-size:       150%;
        }

        A {
            color:           rgb(255,255,128);
        }

        .swipe-arrow::before {
            color: rgba(255,255,128, 0.5);
        }

        .swipe-arrow:hover::before {
            color: rgba(255,255,128, 1.0);
        }

        /* Emulator page */

        #pageAltoMazeWar {
            padding:    0 0 !important;
            background: black;
        }

        alto-emulator {
            position:   absolute;
            top:        0;
            bottom:     0;
            left:       0;
            right:      0;
        }

        alto-emulator canvas {
            padding:    0 0;
            margin:     0 auto;
            max-height: 100%;
            max-width:  100%;
        }

        .altoHelp {
            display:        none;

            background:     lightGray;
            text-align:     center;
            border-radius:  5px;

            position:       absolute;
            top:            0.5em;
            right:          0.5em;

            padding:        0.25em 0.5em;
            color:          black;
        }

        /* Speech bubbles: http://nicolasgallagher.com/pure-css-speech-bubbles/ */
        .altoHelp:after {
            content: "";
            display: block; /* reduce the damage in FF3.0 */
            position: absolute;
            bottom: -19px;
            left: 10px;
            width: 0;
            border-width: 20px 0 0 10px;
            border-style: solid;
            border-color: lightGray transparent;
        }

        .altoHelp.hidden {
            visibility: hidden;
        }

        /* Prevent font scaling in landscape while allowing user zoom
            http://stackoverflow.com/questions/2710764/preserve-html-font-size-when-iphone-orientation-changes-from-portrait-to-landsca
         */
        html {
            -webkit-text-size-adjust: 100%;
        }

        @media (orientation: landscape) {
            figure.float {
                float:      right;
                max-height: 25vw;
                max-width:  30%;
                padding:    1em;
                margin:     0 5px;
            }
        }

        @media (orientation: portrait) {
            figure.float {
                max-width:  40%;
                padding:    0.5em;
                margin:     0 auto;
            }
        }

        figure.float {
            display: table;
            padding: 0;
        }

        figcaption.float {
            font-size: small;
            padding: 2px 0;
            caption-side: bottom;
        }

        figure > img {
            width: 100%;
        }

        #headphoneInstructions2 {
            visibility: hidden;
        }

        #version {
            position:  absolute;
            bottom:    8px;
            left:      0px;
            font-size: small;
        }

        .centered {
            text-align: center;
        }
    </style>
    <div class="darken" id="overlay">
    <swipe-pages>
        <div class="flex-layout" id="page1">
            <div class="header">
                <h1>Maze War <strong>VR</strong></h1>
            </div>
            <div class="middle flex-grid six-element">
                <div class="button" data-page="pageHelp">Help &amp; History</div>
                <div class="button" data-page="pageHeadphoneTest" data-referrer="playSolo">Play vs. Computer</div>
                <div class="button" id="netPlay">Play with Friends</div>
                <div class="button" data-page="pageGameSetup">Game Setup</div>
                <div class="button" data-page="pageCredits">Credits</div>
                <div class="button" data-page="pageHeadsets">Headset Buying Guide</div>
            </div>
            <div class="footer">
                <span id="version">Version 0.1.1</span>
            </div>
        </div>

        <div class="flex-distribute" id="pageHeadphoneTest">
            <div>
                <h1>Headphone Test:</h1>
                <p>
                    <cite>Maze War VR</cite> uses 3D directional audio. If you wear headphones
                    or earbuds, you'll be able to find your opponents by moving your head
                    around and listening carefully.
                </p>
                <p id="headphoneInstructions1">
                    Use the test below to make sure your headphones or earbuds are working and
                    not reversed!
                </p>
                <p id="headphoneInstructions2">
                    You should have heard the word "left" in your left ear; and the word
                    "right" in your right ear. If this was reversed, turn your headphones
                    around or swap your earbuds from ear to ear.
                </p>
            </div>
            <div id="stereoTest" class="button">Test Headphones</div>
            <div id="postHeadphoneTest" class="button">Skip Test</div>
        </div>

        <div class="flex-layout" id="pageNetPlay">
            <div class="header">
                <h1>Play with Friends</h1>
            </div>
            <div class="middle flex-grid two-element">
                <div class="button" data-page="pageInviteFriends">Invite Friends</div>
                <div class="button" data-page="pageHeadphoneTest">Start Game</div>
            </div>
            <div class="footer">
            </div>
        </div>

        <div class="flex-distribute centered" id="pageNetWaiting">
            <div>
                <h1>All alone...</h1>
                <p>
                The game will start once someone else joins you.
                </p>
                <p>
                Invite your friends to play by posting this
                link on social media or sending it via text:
                </p>
            </div>
            <div>
                <input type="text" id="inviteUrl1" class="allow-selection" value="http://mazewar.marciot.com" readonly>
            </div>
            <div>
                <div class="button" id="copyLink1" data-textarea="inviteUrl1">Copy Link</div>
            </div>
        </div>

        <div class="flex-distribute centered" id="pageInviteFriends">
            <div>
                <h1>Send Invitation</h1>
                <p>
                Invite your friends to play by posting this
                link on social media or sending it via text:
                </p>
            </div>
            <div>
                <p>
                <input type="text" id="inviteUrl2" class="allow-selection" value="http://mazewar.marciot.com" readonly>
                </p>
                <div class="button" id="copyLink2" data-textarea="inviteUrl2">Copy Link</div>
            </div>
            <div>
                <div class="button" data-page="back">Go Back</div>
            </div>
        </div>

        <div class="flex-distribute centered" id="pageNoWebRTC">
            <div>
                <h1>Not Available</h1>
                <p>
                We are sorry, this web browser does not support the functionality needed for multi-player mode.
                </p>
                <p>
                If you are using an Apple device, multi-player mode will be made available through an app soon. Stay tuned!
                </p>
            </div>
        </div>

        <div class="flex-distribute centered" id="pageNetworkError">
            <div>
                <h1>Network Error</h1>
            </div>
            <div>
                <p>
                A network error has occured. Please try again later.
                </p>
                <p id="networkErrorReason"></p>
            </div>
            <div class="button" data-page="page1">Go Back</div>
        </div>

        <div class="flex-layout" id="pageGameSetup">
            <div class="header">
                <h1>Game Setup</h1>
            </div>
            <div class="middle flex-grid four-element">
                <div class="button" data-page="pageSetupWizard1">Setup Wizard</div>
                <div class="button" data-page="pageThemeChoices">Theme Selection</div>
                <div class="button" data-page="pageDisplayOptions">Display Options</div>
                <div class="button" data-page="pageControlOptions">Control Options</div>
            </div>
            <div class="footer">
            </div>
        </div>

        <div class="flex-layout" id="pageControlOptions">
            <div class="header">
                <h1>Control Options</h1>
            </div>
            <div class="middle flex-grid two-element">
                <div class="button" data-page="pageRotationalBoost">Rotational Boost</div>
                <div class="button" data-page="pageGamepadConfiguration">Gamepad Configuration</div>
            </div>
            <div class="footer">
            </div>
        </div>

        <div class="flex-layout" id="pageSetupWizard1">
            <div class="header">
                <h1>I will play...</h1>
            </div>
            <div class="button" data-page="pageSetupWizard2">...standing up</div>
            <div class="button" data-page="pageSetupWizard2">...on a swivel chair</div>
            <div class="button" data-page="pageRotationalBoost">...on a stationary chair</div>
        </div>

        <div class="flex-layout" id="pageSetupWizard2">
            <div class="header">
                <h1>I have...</h1>
            </div>
            <div class="button" data-page="pageSmartphone">...a smartphone</div>
            <div class="button" data-page="pageTablet">...a tablet</div>
            <div class="button" data-page="pageDesktop">...a desktop PC or laptop</div>
            <div class="button" data-page="pageDesktopVR">...an Oculus Rift or HTC Vive</div>
        </div>

        <div class="flex-layout" id="pageSmartphone">
            <div class="header">
                <h1>I have...</h1>
            </div>
            <div class="button" data-page="pageCardboardVR">...a Homido, Merge or ViewMaster</div>
            <div class="button" data-page="pageCardboardVR">...a Google Cardboard</div>
            <div class="button" data-page="pageGearVR">...a Samsung Gear VR</div>
            <div class="button" data-page="pageOtherVR">...some other headset</div>
            <div class="button" data-page="pageTablet">...no headset, just my phone</div>
        </div>

        <div class="flex-distribute" id="pageCardboardVR">
            <div>
                <h1>Headset Controls:</h1>
                <p>
                Hold down the trigger on your headset to move in the direction you are facing; press and release
                the trigger rapidly to shoot.
                </p>
            </div>
            <div class="button" data-page="page1">Back</div>
        </div>

        <div class="flex-distribute" id="pageOtherVR">
            <div>
                <h1>Simple Headset Controls:</h1>
                <p>
                Hold down the trigger on your headset to move in the direction you are facing; press and release
                the trigger rapidly to shoot.
                </p>
            </div>
            <div>
                <h2>Using a Bluetooth Gamepad:</h2>
                <p>
                If your headset came with a Bluetooth gamepad, you will need to pair the headset to your phone.
                Then go to "Game Setup -> Control Options -> Gamepad Configuration" screen to configure a button on it as the trigger.
                </p>
            </div>
            <div class="button" data-page="pageGameSetup">Game Setup</div>
        </div>

        <div class="flex-distribute" id="pageTablet">
            <div>
                <h1>Smartphone or Tablet Users:</h1>
                <p>
                Stand and hold the device in front of your face. Turn your body or move the device up and down to look around.
                Press your finger anywhere on the screen to move in the direction you are facing; tap to shoot.</p>
                <p>
                By default, the display will be shown in 2D on your phone or tablet. If you would like, you can enable anaglyph 3D from the "Display Options"
                screen. This allows you to see 3D using inexpensive red/cyan glasses.
                </p>
            </div>
            <div class="button" data-page="pageDisplayOptions">Display Options</div>
        </div>

        <div class="flex-distribute" id="pageDesktop">
            <div>
                <h1>Desktop or Laptop Users:</h1>
                <p>
                Move the mouse to look around, hold down the mouse button to move in the direction you are facing; click rapidly to shoot.
                </p>
                <p>
                By default, the display will be shown in 2D on your monitor. If you would like, you can enable anaglyph 3D from the "Display Options"
                screen. This allows you to see 3D using inexpensive red/cyan glasses.
                </p>
            </div>
            <div class="button" data-page="pageDisplayOptions">Display Options</div>
        </div>

        <div class="flex-distribute" id="pageGearVR">
            <div>
                <h1>Samsung Gear VR Users:</h1>
                <p>
                You must download the <a href="https://www.oculus.com/experiences/gear-vr/849609821813454/" target="_blank">Samsung Internet Browser for Gear VR</a>
                from the <cite>Oculus Store</cite> Android app. This is not the same as the <cite>Samsung Internet for Android</cite> from the <cite>Galaxy App</cite> store.
                </p>
                <p>
                    You may then play <cite>Maze War VR</cite> online by going to <a href="http://marciot.com/mazewar-vr" target="_blank">http://marciot.com/mazewar-vr</a> while in VR mode.
                </p>
            </div>
            <div class="button" data-page="page1">Back</div>
        </div>

        <div class="flex-distribute" id="pageDesktopVR">
            <div>
                <h1>Oculus Rift &amp; HTC Vive Users:</h1>
                <p>
                At the present time, you must download an experimental version of <a href="https://webvr.info/get-chrome/" target="_blank">Chrome</a> or
                <a href="https://mozvr.com/" target="_blank">Firefox</a> to play <cite>Maze War VR</cite>.
                </p>
                <p>
                Once you have these browsers setup, follow the instructions at <a href="https://webvr.info">https://webvr.info</a>
                to enable the experimental WebVR and the Gamepad extensions.
                </p>
                <p>
                When you begin a game, the page will go black. This means that the graphics have been sent to the headset and you should put it on. While in a game, double-tap the headset with your finger to re-center your view.
                </p>
            </div>
            <div class="button" data-page="page1">Go back</div>
        </div>

        <div class="flex-distribute" id="pageCredits">
            <div>
                <h1>Credits</h1>
                <div class="side-by-side align-top">
                    <div>
                        This game may include source code from:
                        <ul>
                        <li><a href="https://threejs.org/">THREE.js</a>
                        <li><a href="http://webcomponents.org">Webcomponents.org</a>
                        <li><a href="https://github.com/chenglou/tween-functions">Tween-Functions</a>
                        <li><a href="http://peerjs.com">Peerjs.com</a>
                        <li><a href="http://www.yorgsite.fr/experiments/YConsole/">YConsole</a>
                        <li><a href="https://github.com/eface2face/cordova-plugin-iosrtc">cordova-plugin-iosrtc</a>
                        <li><a href="https://github.com/googlevr/webvr-polyfill">WebVR Polyfill</a>
                        <li><a href="https://www.promisejs.org/">promisejs.org</a>
                        </ul>
                    </div>
                    <div>
                        This game include media from:
                        <ul>
                            <li><a href="http://fav.me/d4ecxyt">Brick texture</a> by AGF81.
                            <li><a href="https://www.freesound.org/s/169762/">Footstep sounds</a> by nhaudio.
                            <li><a href="http://www.freesound.org/people/SweetNeo85/sounds/13797/">Wilhelm scream</a> recorded by SweetNeo85
                            <li><a href="https://www.freesound.org/s/183467/">Pow sound</a> by Snapper4298
                        </ul>
                        <figure class="sponsor">
                            <figcaption>Testing services provided by:</figcaption>
                            <a href="https://browserstack.com">
                            <img src="artwork/browserstack.png">
                            </a>
                        </figure>
                    </div>
                </div>
                <p class="centered">
                Complete source code and licenses are available on <a href="https://github.com/marciot/mazewar-vr">GitHub</a>.
                </p>
                <p class="centered">
                Please help support the developement of this program and others. Check out my <a href="https://www.patreon.com/marciot">Patreon</a> page.
                </p>
            </div>
        </div>

        <div class="flex-distribute" id="pageHelp">
            <div>
                <h1>How to Play</h1>
                <p>
                    Find your opponents in the maze and shoot at them! Face in the direction you want to go and hold down the button to walk; press and release the button rapidly to shoot.
                </p>
                <h2>Let your ears be your guide!</h2>
                <p>
                    <cite>Maze War VR</cite> has positional audio. Wear good stereo headphones<sup>&dagger;</sup>, listen carefully and with practice you'll learn to track your opponents by sound!
                </p>
                <p>
                    <sup>&dagger;</sup> Use the audio test at the start of each game to
                    make sure the left and right are not reversed!
                </p>
            </div>
            <div>
                <p class="centered">
                Please help further the development of this remake. Check out my <a href="https://www.patreon.com/marciot">Patreon</a> page.
                </p>
            </div>
            <div class="button" data-page="pageHistory">Next: 40 Years of Maze War</div>
        </div>

        <div class="flex-distribute" id="pageHistory">
            <div>
                <h1>The History of Maze War</h1>
                <figure class="float">
                    <img src="artwork/mazewar-imlac.jpg">
                    <figcaption>
                    Screen capture from <a rel="nofollow" class="external free" href="https://www.youtube.com/watch?v=ZgT9IgRlrvI&amp;ab_channel=brucedamer">video by Bruce Damer</a>, <a href="http://creativecommons.org/licenses/by/2.5" title="Creative Commons Attribution 2.5">CC BY 2.5</a>, <a href="https://commons.wikimedia.org/w/index.php?curid=47507741">wikimedia</a>
                    </figcaption>
                </figure>
                <p>
                The original <cite>Maze War</cite> was written by Steve Colley and Greg Thompson in 1974 at the NASA Ames Research Center in California.
                </p>
                <p>
                Players moved down a three-dimensional maze taking shots at opponents, making it the <a href="http://www.polygon.com/features/2015/5/21/8627231/the-first-first-person-shooter" target="_blank">first first person shooter</a> game!
                </p>
            </div>
            <div class="button" data-page="pageInspiration">Maze War on the Alto</div>
        </div>

        <div class="flex-distribute" id="pageInspiration">
            <div>
                <h1>Maze War on the Alto</h1>
                <figure class="float">
                <img src="artwork/mazewar-alto.png">
                <figcaption>Maze Wars on the Xerox Alto</figcaption>
                </figure>
                <p>
                By 1977, the game was taken to MIT, where it was rewritten for the Xerox Alto
                and made playable on an early version of the Ethernet packet switched network.
                </p>
                <p>
                I've made a special effort in <cite>Maze War VR</cite> to use the same networking protocol as that version, allowing the two games to interact (see <a href="https://youtu.be/XXOH0z3Aki8" target="_blank">video demo on YouTube</a>).
                </p>
            </div>
            <div id="altoLink" class="button" data-page="pagePlayAltoIntro">Play the Alto Version!</div>
        </div>

        <div class="flex-distribute" id="pagePlayAltoIntro">
            <div>
                <h1>Maze War on the Alto</h1>
                On the next page, you can play Maze War on the Xerox Alto. The demonstration is made possible by the efforts of the following people and organizations:
                <ul>
                <li><a href="https://github.com/livingcomputermuseum/ContrAlto">Contralto</a> from <a href="http://www.livingcomputers.org">Living
                Computers: Museum + Labs</a>
                <li><a href="http://www.loomcom.com/contraltojs/">ContraltoJS</a> from <a href="http://www.loomcom.com">loomcom.com</a>
                <li>The preservation efforts of <a href="http://bitsavers.org">Bitsavers.org</a>
                </ul>
                </p>
            </div>
            <div id="altoLink" class="button" data-page="pageAltoMazeWar">Start Demo</div>
        </div>

        <div class="flex-distribute" id="pageDisplayOptions">
            <div>
                <h1>Select your VR Experience:</h1>
                <p>
                Click an icon below to choose your VR experience. Click the headset icon on the left if you will be wearing a VR headset;
                click the middle icon if you are playing without a headset in 2D; or click on the right-most icon if you will be wearing red/cyan glasses for 3D.
                </p>
                <div id="mode-select">
                    <p>
                    <svg id="headset" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 63 58.75" enable-background="new 0 0 63 47" xml:space="preserve"><line x1="87.4" y1="37.2" x2="97.2" y2="37.2"/><g><path d="M42.9,20c-3.4,0-6.2,2.8-6.2,6.2s2.8,6.2,6.2,6.2s6.2-2.8,6.2-6.2S46.4,20,42.9,20z M42.9,31.5c-2.9,0-5.2-2.4-5.2-5.2   S40,21,42.9,21s5.2,2.4,5.2,5.2S45.8,31.5,42.9,31.5z"/><path d="M20.9,20c-3.4,0-6.2,2.8-6.2,6.2s2.8,6.2,6.2,6.2s6.2-2.8,6.2-6.2S24.4,20,20.9,20z M20.9,31.5c-2.9,0-5.2-2.4-5.2-5.2   S18,21,20.9,21s5.2,2.4,5.2,5.2S23.8,31.5,20.9,31.5z"/><path d="M55.7,9V7.9c0-1.6-1.3-2.9-2.9-2.9H11.3C9.7,5,8.4,6.3,8.4,7.9V9c-2.3,0.7-4,2.8-4,5.3v22.6c0,3,2.5,5.5,5.5,5.5h13.4   c1.8,0,3.4-1,4.1-2.6c0,0,0-0.1,0-0.1l0.2-0.5h8l0.1,0.4c0,0,0,0.1,0,0.1c0.7,1.7,2.3,2.8,4.2,2.8h13.9c3,0,5.5-2.5,5.5-5.5V14.3   C59.4,11.8,57.8,9.8,55.7,9z M10.7,7.9c0-0.3,0.3-0.6,0.6-0.6h41.4c0.3,0,0.6,0.3,0.6,0.6v2H10.7V7.9z M27.3,36.7l2-5   c0.5-1,1.4-1.6,2.5-1.6c0.9,0,2.1,0.5,2.6,1.7l1.7,4.9H27.3z M57.2,36.9c0,1.8-1.5,3.2-3.2,3.2H40c-0.9,0-1.7-0.5-2.1-1.4l-2.6-7.3   c-0.6-1.4-1.9-2.3-3.5-2.3c-1.5,0-2.8,0.8-3.4,2.2l-3,7.5c-0.4,0.8-1.2,1.3-2.1,1.3H9.9c-1.8,0-3.2-1.5-3.2-3.2V14.3   c0-1.8,1.5-3.2,3.2-3.2h44c1.8,0,3.2,1.5,3.2,3.2V36.9z"/></g></svg>
                    <svg id="monitor" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" x="0px" y="0px" viewBox="0 0 146 158.75" enable-background="new 0 0 146 127" xml:space="preserve"><g><path d="M68.5,18H78c0.6,0,1-0.4,1-1s-0.4-1-1-1h-9.5c-0.6,0-1,0.4-1,1S67.9,18,68.5,18z"/><path d="M121,21H25c-2.2,0-4,1.8-4,4v57c0,2.2,1.8,4,4,4h96c2.2,0,4-1.8,4-4V25C125,22.8,123.2,21,121,21z M123,82c0,1.1-0.9,2-2,2   H25c-1.1,0-2-0.9-2-2V25c0-1.1,0.9-2,2-2h96c1.1,0,2,0.9,2,2V82z"/></g><path d="M125,9H21c-5.5,0-10,4.5-10,10v68c0,5.5,4.5,10,10,10h37v9l-7.5,5.2c-1.5,1.1-2.5,2.5-1.8,4.9c0.7,2.3,2.4,3,4.3,3h40  c1.9,0,3.6-0.6,4.3-3c0.7-2.3-0.3-3.8-1.8-4.8l-7.5-5.3l0-8.9h37c5.5,0,10-4.5,10-10V19C135,13.5,130.5,9,125,9z M93.2,114.5  c0.5,0.3,0.4,0.6-0.2,0.6H53c-0.5,0-0.6-0.3-0.2-0.6l8-5.6h17.7c0.6,0,1-0.4,1-1v-0.2c0-0.6-0.4-1-1-1H62V95h22v12  c0,0.6,0.3,1.2,0.8,1.5L93.2,114.5z M131,87c0,3.3-2.7,6-6,6H88h-4H62h-4H21c-3.3,0-6-2.7-6-6V19c0-3.3,2.7-6,6-6h104  c3.3,0,6,2.7,6,6V87z"/></svg>
                    <svg id="anaglyph" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" x="0px" y="0px" viewBox="0 0 146 158.75" enable-background="new 0 0 146 127" xml:space="preserve"><g><path d="M68.5,18H78c0.6,0,1-0.4,1-1s-0.4-1-1-1h-9.5c-0.6,0-1,0.4-1,1S67.9,18,68.5,18z"/><path d="M121,21H25c-2.2,0-4,1.8-4,4v57c0,2.2,1.8,4,4,4h96c2.2,0,4-1.8,4-4V25C125,22.8,123.2,21,121,21z M123,82c0,1.1-0.9,2-2,2   H25c-1.1,0-2-0.9-2-2V25c0-1.1,0.9-2,2-2h96c1.1,0,2,0.9,2,2V82z"/></g><path d="M125,9H21c-5.5,0-10,4.5-10,10v68c0,5.5,4.5,10,10,10h37v9l-7.5,5.2c-1.5,1.1-2.5,2.5-1.8,4.9c0.7,2.3,2.4,3,4.3,3h40  c1.9,0,3.6-0.6,4.3-3c0.7-2.3-0.3-3.8-1.8-4.8l-7.5-5.3l0-8.9h37c5.5,0,10-4.5,10-10V19C135,13.5,130.5,9,125,9z M93.2,114.5  c0.5,0.3,0.4,0.6-0.2,0.6H53c-0.5,0-0.6-0.3-0.2-0.6l8-5.6h17.7c0.6,0,1-0.4,1-1v-0.2c0-0.6-0.4-1-1-1H62V95h22v12  c0,0.6,0.3,1.2,0.8,1.5L93.2,114.5z M131,87c0,3.3-2.7,6-6,6H88h-4H62h-4H21c-3.3,0-6-2.7-6-6V19c0-3.3,2.7-6,6-6h104  c3.3,0,6,2.7,6,6V87z"/><path d="m 41.3,40.2 c -2.4,0 -4.3,1.9 -4.3,4.3 l 0,17.1 c 0,2.4 1.9,4.3 4.3,4.3 l 21.4,0 c 1,0 1.9,-0.3 2.6,-0.9 l 6.4,-5 c 0.2,-0.1 0.2,-0.1 0.5,-0.2 0.6,-0.2 1.4,-0.3 1.2,-0.3 -0.2,0 0.5,0.1 1,0.3 0.3,0.1 0.3,0.1 0.5,0.2 l 6.6,5.1 c 0.7,0.6 1.7,0.9 2.6,0.9 l 21.4,0 c 2.4,0 4.3,-1.9 4.3,-4.3 l 0,-17.1 c 0,-2.4 -1.9,-4.3 -4.3,-4.3 z" /><path d="m 44.2,45.9 c -1,0 -1.8,0.8 -1.8,1.8 l 0,10.7 c 0,1 0.8,1.8 1.8,1.8 l 17.4,0 c 1,0 1.8,-0.8 1.8,-1.8 l 0,-10.7 c 0,-1 -0.8,-1.8 -1.8,-1.8 z" style="fill: darkRed;"/><path d="m 85.2,45.9 c -1,0 -1.8,0.8 -1.8,1.8 l 0,10.7 c 0,1 0.8,1.8 1.8,1.8 l 17.4,0 c 1,0 1.8,-0.8 1.8,-1.8 l 0,-10.7 c 0,-1 -0.8,-1.8 -1.8,-1.8 z" style="fill: darkCyan;"/></svg>
                    </p>
                    <p>
                    Icons by Nick Bluth from the Noun Project
                    </p>
                </div>
            </div>
            <div class="button" data-page="page1">Back</div>
        </div>

        <div class="flex-distribute" id="pageThemeChoices">
            <div>
                <h1>Select Theme:</h1>
                <p>
                <cite>Maze War VR</cite> comes with two different themes. The day theme is bright and is suitable for most devices; the night theme provides a darker and suspenseful atmosphere, but may require a faster device for smooth playback.
                </p>
            </div>
            <div class="button" data-href="?theme=day">Day Theme</div>
            <div class="button" data-href="?theme=night">Night Theme</div>
        </div>

        <div class="flex-distribute" id="pageRotationalBoost">
            <div>
                <h1>Rotational Boost:</h1>
                <p>
                Rotational Boost allows you to look behind you while seated on a stationary chair.
                However, playing this way may increase your chances of motion sickness. If you wish to
                proceed:
                <ul>
                    <li>Click the "Allow" button here.
                    <li>Once wearing your headset in a game:
                    <ul>
                        <li>Sit comfortably and relaxed, looking straight ahead.
                        <li>Double-tap the side of your headset.
                        <li>The message &quot;View centered. Boost enabled.&quot; will appear in your headset.
                        <li>You may double-tap again at any time to toggle it off and on.
                    </ul>
                </ul>
                <div class="side-by-side">
                <div id="disableRotationalBoost" class="button" data-page="back">Go back</div>
                <div id="enableRotationalBoost"  class="button" data-page="back">Allow</div>
                </div>
                </p>
            </div>
        </div>

        <div class="flex-distribute" id="pageGamepadConfiguration">
            <div>
                <h1>Gamepad Configuration:</h1>
                <p>
                    If you have a device with an electronic controller or gamepad, you will need to configure a
                    game pad button for use with <cite>Maze War VR</cite>. You can do so here, or by pressing
                    a game pad button within a minute of starting a game.
                <p>
            </div>
            <div id="configureGamepad" class="button">Choose Gamepad Button</div>
            <div class="button" data-page="page1">Go Back</div>
        </div>

        <div class="flex-distribute" id="pageHeadsets">
            <div>
                <h2>Choosing a VR Headset</h2>

                Virtual reality is relatively new and there are a bewildering number of headset choices
                out there. Before you buy, consider the following questions:
                <ul>
                    <li>What is your budget?
                    <li>Is there a headset made specifically for my phone or should I buy
                        a generic headset?
                    <li>Does a headset have an integrated trigger or does it require a gamepad?
                    <li>Do you wear glasses?
                </ul>
            </div>
            <div class="button" data-page="pageHeadsets1">Companion vs. Generic</div>
        </div>

        <div class="flex-distribute" id="pageHeadsets1">
            <div>
                <h2>Companion Headsets</h2>
                <p>
                Some phones have a companion headset for VR. These companion headsets are designed specifically for
                your phone and are generally your best choice.
                </p>
                <p>
                If you have a Samsung Galaxy phone, consider the <a target="_blank" href="https://www.amazon.com/gp/product/B01HU3J9QA/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B01HU3J9QA&linkCode=as2&tag=marciot-20&linkId=c34467730a87718185b1feb9fca99073">Gear VR (amazon link)</a>.<br>
                If you have a Daydream-ready phone, consider the <a target="_blank" href="https://www.amazon.com/gp/product/B01N634P7O/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B01N634P7O&linkCode=as2&tag=marciot-20&linkId=d4a6fb5b8c47ba451ca33813939dd365">Google Daydream View (amazon link)</a>.

                <img src="http://ir-na.amazon-adsystem.com/e/ir?t=marciot-20&l=am2&o=1&a=B01HU3J9QA" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
                <img src="http://ir-na.amazon-adsystem.com/e/ir?t=marciot-20&l=am2&o=1&a=B01N634P7O" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />

                <h2>Generic Headsets</h2>
                <p>
                If your phone does not have a companion headset or you own an iPhone, there are generic headsets that work with great with <cite>Maze War VR</cite>.
                </p>
                <p>
                When you pick a generic, get one with a trigger button, as not all generics do. On the next few pages, I present some excellent choices.
                </p>
            </div>
            <div class="button" data-page="pageHeadsets2">Next Up: The Homido</div>
        </div>

        <div class="flex-distribute" id="pageHeadsets2">
            <div>
                <h2>The Homido</h2>
                <p>
                The <cite>Homido V2</cite> headset is a great choice for <cite>Maze War VR</cite>. Unlike
                the original, the updated version adds a trigger button. The Homido accomodates most phones and includes premium features like an adjustable focus and IPD (interpupilary distance) and comes with a hard-shell protective carrying case.
                </p>
                <p>
                Wide straps hold the phone to your face for hands-free gaming, making the <cite>Homido V2</cite>
                a fantastic choice for <cite>Maze War VR</cite>.
                </p>
                <div class="side-by-side">
                    <img src="artwork/homido-v2.png">

                    <div class="associate-links">
                        <a href="https://www.amazon.com/gp/product/B01LZWDNX6/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B01LZWDNX6&linkCode=as2&tag=marciot-20&linkId=d1dc4fe1c00bf166bf2fd7eaf2ddc08d" target="_blank">
                        <span>Get the <cite>Homido V2</cite></span>
                        </a>
                        <br>at amazon.com
                    </div>
                </div>
                <img src="http://ir-na.amazon-adsystem.com/e/ir?t=marciot-20&l=am2&o=1&a=B01LZWDNX6" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
            </div>
            <div class="button" data-page="pageHeadsets3">Next Up: The Merge VR</div>
        </div>

        <div class="flex-distribute" id="pageHeadsets3">
            <div>
                <h2>The Merge VR</h2>
                <p>
                The <cite>Merge VR</cite> headset features a slot that works well with skinny phones like the iPhone.
                It is made out of soft foam, making it light weight and comfortable to wear. The padded exterior
                also protects your phone from accidental drops. In a fairly unique capability, it sports
                <strong>two</strong> independent trigger buttons. With lens adjustments and head straps, the
                <cite>Merge VR</cite> is a feature packed headset at a mid-range price!
                </p>
                <div class="side-by-side">
                    <img src="artwork/merge-vr.png">

                    <div class="associate-links">
                        <a href="https://www.amazon.com/gp/product/B015CD6NVE/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B015CD6NVE&linkCode=as2&tag=marciot-20&linkId=88c101df6e472379e81b812e2954d1f6" target="_blank">
                        <span>Get the <cite>Merge VR</cite></span>
                        </a>
                        <br>at amazon.com
                    </div>
                </div>
                <img src="http://ir-na.amazon-adsystem.com/e/ir?t=marciot-20&l=am2&o=1&a=B015CD6NVE" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
            </div>
            <div class="button" data-page="pageHeadsets4">Next Up: The ViewMaster</div>
        </div>

        <div class="flex-distribute" id="pageHeadsets4">
            <div>
                <h2>The ViewMaster</h2>
                <p>
                The <cite>Mattel ViewMaster VR</cite> accomodates most phones and has a responsive trigger.
                It starts at $17, making it a fantastic choice if you don't want to spend too much to
                experience VR. The deluxe version adds focal length adjustment, an improved latch and a headphone jack (which is recommended for <cite>Maze Wars VR</cite>, unless you have Bluetooth headphones).
                </p>
                <p>
                The downside is that the ViewMaster does not fit over glasses and it lacks head straps,
                meaning you will need to hold it up to your face as you play.
                </p>

                <div class="side-by-side">
                    <img src="artwork/viewmaster.png">

                    <div class="associate-links">
                        <a href="https://www.amazon.com/gp/product/B011EG5HJ2/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B011EG5HJ2&linkCode=as2&tag=marciot-20&linkId=c37977d6d52ef8ecc98818820368c7a3" target="_blank">
                        <span><cite>View-Master VR Starter Pack</cite></span>
                        </a>
                        <br>or<br>
                        <a href="https://www.amazon.com/gp/product/B01CNSO79Q/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B01CNSO79Q&linkCode=as2&tag=marciot-20&linkId=deb6db561f6a121a25ff2857db7010a2" target="_blank">
                        <span><cite>Deluxe View-Master VR Viewer</cite></span>
                        </a>
                        <br>at amazon.com
                    </div>
                </div>
                <img src="http://ir-na.amazon-adsystem.com/e/ir?t=marciot-20&l=am2&o=1&a=B011EG5HJ2" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
                <img src="http://ir-na.amazon-adsystem.com/e/ir?t=marciot-20&l=am2&o=1&a=B01CNSO79Q" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
            </div>
            <div class="button" data-page="pageHeadsets5">Next: Cardboard Headsets</div>
        </div>

        <div class="flex-distribute" id="pageHeadsets5">
            <div>
                <h1>Cardboard Headsets</h1>
                <p>
                Cardboard headsets are the least expensive. They are spacious enough for
                people with glasses, but they have disadvantages: they are not very durable
                nor particularly comfortable; they also leak a lot of light around the
                sides which can detract from the VR experience.
                </p>
                <h2>Magnetic vs. Foam Trigger</h2>
                <p>
                Older cardboard headsets use a magnetic trigger that won't work with
                <cite>Maze War VR</cite>.
                </p>
                <p>
                If you buy one, look for a Cardboard Version 2 headset; these
                have a trigger with conductive foam and will work with
                <cite>Maze War VR</cite>.
                </p>
            </div>
            <div class="button" data-page="pageHeadsets6">Next: Go Retro!</div>
        </div>
        
        <div class="flex-distribute" id="pageHeadsets6">
            <div>
                <h1>Can I use red/cyan (anaglyph) glasses?</h1>
                <img class="float" src="artwork/red-cyan.png">
                <p>
                Absolutely! These old-style 3D glasses were common in theaters in the 50s; they allow you
                to play <cite>Maze War VR</cite> in 3D on a regular PC monitor, tablet or smartphone. Choose the anaglyph mode from the &quot;Display Options&quot; to play.
                </p>
                <p>
                You can get <a target="_blank" href="https://www.amazon.com/gp/search?ie=UTF8&tag=marciot-20&linkCode=ur2&linkId=7039ae7afbd53a756bb85f6ffd16d437&camp=1789&creative=9325&index=electronics&keywords=Red Cyan Anaglyph">anaglyph glasses</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=marciot-20&l=ur2&o=1" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> online from $1 to $10. The least expensive are made out of paper, but you can get frames or clip-ons to wear over prescription glasses.
                </p>
                <p>
                Make sure you use the red/cyan variety as the other color combinations will not work with <cite>Maze War VR</cite>. Clear 3D glasses from modern movie theaters will not work either.
                </p>
            </div>
            <div class="button" data-page="pageHeadsets7">Next: Go Naked!</div>
        </div>

        <div class="flex-distribute" id="pageHeadsets7">
            <div>
                <h1>Go headset free!</h1>
                <p>
                <cite>Maze War VR</cite> can be played on a regular PC monitor, tablet or smartphone.
                </p>
                <p>
                Select the regular monitor mode from the &quot;Display Options&quot; to play without 3D.
                </p>
            </div>
            <div class="button" data-page="page1">Let's Play!</div>
        </div>

        <div id="pageAltoMazeWar">
            <alto-emulator>
            </alto-emulator>
            <div class="altoHelp" id="altoHelp1">
                Starting up.
            </div>
            <div class="altoHelp" id="altoHelp2">
                Keep waiting. I'll say when.
            </div>
            <div class="altoHelp" id="altoHelp3">
                Type "mazewar"
            </div>
            <div class="altoHelp" id="altoHelp4">
                ...followed by ENTER
            </div>
            <div class="altoHelp hidden" id="altoHelp5">
            </div>
            <div class="altoHelp" id="altoHelp6">
                Leave the duke host blank.
            </div>
            <div class="altoHelp" id="altoHelp7">
                Something's happening...
            </div>
            <div class="altoHelp" id="altoHelp8">
                Searching for network players.
            </div>
            <div class="altoHelp" id="altoHelp9">
                This takes a while.
            </div>
            <div class="altoHelp" id="altoHelp10">
                A bloody long while.
            </div>
            <div class="altoHelp" id="altoHelp11">
                Type D to move forwards.
            </div>
            <div class="altoHelp" id="altoHelp12">
                Type S or F to turn left or right.
            </div>
            <div class="altoHelp" id="altoHelp13">
                Type A to do an about face.
            </div>
            <div class="altoHelp" id="altoHelp14">
                Click the mouse to shoot an opponent.
            </div>
        </div>
    </swipe-pages>
    </div>
</template>

<script>
function gotoRecommendedHeadsets() {
    document.querySelector("about-box").showRecommendedHeadsets();
}

(function (thisDoc) {
    var AboutBoxProto = Object.create(HTMLElement.prototype);

    AboutBoxProto.createdCallback = function() {
        var t = thisDoc.getElementById('AboutBoxTemplate');
        var clone = document.importNode(t.content, true);
        //var shadowRoot = this.createShadowRoot();
        var shadowRoot = this;
        shadowRoot.appendChild(clone);

        function selectExperience(mode) {
            this.dispatchCallback("gfxModeSelected", mode);
            swipePages.gotoPage("page1");
        }

        shadowRoot.querySelector("#headset").addEventListener("click", selectExperience.bind(this, "headset"));
        shadowRoot.querySelector("#monitor").addEventListener("click", selectExperience.bind(this, "monitor"));
        shadowRoot.querySelector("#anaglyph").addEventListener("click", selectExperience.bind(this, "anaglyph"));

        // Net play
        var me = this;
        function gotoNetPlay(e) {
            if(typeof window.RTCPeerConnection === 'undefined') {
                me.swipePages.gotoPage("pageNoWebRTC");
            } else {
                me.swipePages.gotoPage("pageNetPlay");
            }
        }
        shadowRoot.querySelector("#netPlay").addEventListener("click", gotoNetPlay);

        function startNetGame() {
            shadowRoot.dispatchCallback("startNetworkGame");
            me.swipePages.gotoPage("pageNetWaiting");
        }

        function postHeadphoneTest() {
            console.log("Post headphone test");
            switch(me.swipePages.getReferringPage()) {
                case "playSolo":
                    console.log("Starting solo game");
                    shadowRoot.dispatchCallback("startSoloGame");
                    break;
                case "pageNetPlay":
                    startNetGame();
                    break;
                default:
                    console.log(me.swipePages.getReferringPage());
            }
        }
        shadowRoot.querySelector("#postHeadphoneTest").addEventListener("click", postHeadphoneTest);

        function enableBoost(e) {
            motionTracker.rotationalBoostAllowed = true;
            if(me.swipePages.getReferringPage() === "pageSetupWizard1") {
                me.swipePages.gotoPage("pageSetupWizard2");
            } else {
                me.swipePages.followLink(e.target);
            }
        }
        function disableBoost(e) {
            motionTracker.rotationalBoostAllowed = false;
            me.swipePages.followLink(e.target);
        }
        shadowRoot.querySelector("#enableRotationalBoost").addEventListener("click", enableBoost);
        shadowRoot.querySelector("#disableRotationalBoost").addEventListener("click", disableBoost);

        var swipePages    = shadowRoot.querySelector("swipe-pages");
        var emulator      = shadowRoot.querySelector("alto-emulator");
        var altoStartHelp = shadowRoot.querySelector("#altoStartHelp");
        var altoKeyHelp   = shadowRoot.querySelector("#altoKeyHelp");

        this.swipePages   = swipePages;

        swipePages.bindElements(
            Array.prototype.filter.call(
                shadowRoot.querySelectorAll(".button"),
                el => el.id === ''
            )
        );

        shadowRoot.querySelector("#altoLink").addEventListener("click",
            function(e) {
                e.preventDefault();
                e.stopPropagation();
                swipePages.followLink(e.target);
                emulator.startEmulator();
                altoHelper.start();
            }
        );

        var altoHelper = new function() {
            var enterPressed    = 0;
            var gameKeysPressed = 0;
            var currentState    = 0;
            var currentTip      = 0;

            var stateTransitions = [
                {packetCount: 0,  enterCount: 0, gameKeyCount: 0},
                {packetCount: 3,  enterCount: 0, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 0, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 0, gameKeyCount: 1},
                {packetCount: 6,  enterCount: 1, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 2, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 3, gameKeyCount: 0},
                {packetCount: 6,  enterCount: 3, gameKeyCount: 0, delay: 3000},
                {packetCount: 10, enterCount: 3, gameKeyCount: 0},
                {packetCount: 17, enterCount: 3, gameKeyCount: 0},
                {packetCount: 17, enterCount: 3, gameKeyCount: 0, delay: 22000},
                {packetCount: 17, enterCount: 3, gameKeyCount: 1, delay: 3000},
                {packetCount: 17, enterCount: 3, gameKeyCount: 1, delay: 3000},
                {packetCount: 17, enterCount: 3, gameKeyCount: 1, delay: 3000},
                {packetCount: 17, enterCount: 3, gameKeyCount: 1, delay: 3000}
            ];

            this.checkState = function() {
                if(currentState === stateTransitions.length) {
                    clearInterval(this.timer);
                    return;
                }
                var state = stateTransitions[currentState];
                if((ethernetController.packetsSent >= state.packetCount) &&
                   (enterPressed                   >= state.enterCount)  &&
                   (gameKeysPressed                >= state.gameKeyCount))
                {
                    currentState++;
                    gameKeysPressed = 0;
                    showTip(currentState, state.delay);
                }
            }

            function showTip(which, delayBefore) {
                if(delayBefore) {
                    setTimeout(showTip, delayBefore, which);
                    return;
                }
                var cur = shadowRoot.querySelector("#altoHelp" + currentTip);
                var next = shadowRoot.querySelector("#altoHelp" + which);
                if(cur) {
                    cur.style.display = "none";
                }
                if(next) {
                    next.style.display = "block";
                    currentTip = which;
                }
            }

            this.keyHandler = function(event) {
                console.log("Key handler", event);
                switch (event.key) {
                    case "Enter":
                        enterPressed++;
                        break;
                    case "a":
                    case "s":
                    case "d":
                    case "f":
                    case "g":
                        gameKeysPressed++;
                        break;
                }
                this.checkState();
            };

            this.start = function() {
                var altoDisplay = shadowRoot.querySelector("#altoDisplay");
                var altoInput   = shadowRoot.querySelector("#altoTextArea");
                if(altoDisplay) {
                    altoInput.addEventListener("keydown", altoHelper.keyHandler.bind(altoHelper));
                    altoDisplay.addEventListener("click",   altoInput.focus.bind(altoInput));
                } else {
                    console.log("cannot find alto display");
                }

                this.timer = setInterval(this.checkState.bind(this), 1000);
            };
        }

        this.eventListeners = {
            gfxModeSelected:  [],
            startSoloGame:    [],
            startNetworkGame: []
        };

        // Facebook share
        function shareInviteOnFacebook(e) {
            e.preventDefault();
            e.stopPropagation();
            if(window.isCrosswalk || typeof FB === "undefined") {
                const url = "https://www.facebook.com/sharer/sharer.php?u=http%3A//www.marciot.com/mazewar-vr/";
                openHyperlink(url);
            } else {
                console.log("Opening FB share dialog");
                FB.ui({
                        method: 'share',
                        mobile_iframe: true,
                        href: 'http://www.marciot.com/mazewar-vr',
                    }, function(response){});
            }
        }
        //shadowRoot.querySelector("#inviteFriends").addEventListener("click", shareInviteOnFacebook);

        // Copy Link
        function copyLink(e) {
            var textarea = document.getElementById(e.target.getAttribute("data-textarea"));
            textarea.select();
            try {
                var successful = document.execCommand('copy');
                var msg = successful ? 'successful' : 'unsuccessful';
                console.log('Copy text command was ' + msg);
            } catch(err) {
                console.log('Oops, unable to copy');
            }
        }
        shadowRoot.querySelector("#copyLink1").addEventListener("click", copyLink);
        shadowRoot.querySelector("#copyLink2").addEventListener("click", copyLink);

        // Gamepad Configuration
        function configureGamepad() {
            gpClicker.beginTimedCapture(10000, shadowRoot.querySelector("#configureGamepad"));
        }
        shadowRoot.querySelector("#configureGamepad").addEventListener("click", configureGamepad);

        // Sound test
        function testStereo() {
            var audio = new Audio('sounds/left-right.mp3');
            audio.play();
            shadowRoot.querySelector("#stereoTest").innerText = "Test Headphones Again";
            shadowRoot.querySelector("#postHeadphoneTest").innerText = "Okay, start the game!";
            shadowRoot.querySelector("#headphoneInstructions1").style.visibility = "hidden";
            shadowRoot.querySelector("#headphoneInstructions2").style.visibility = "visible";
        }
        shadowRoot.querySelector("#stereoTest").addEventListener("click", testStereo);

        // Open external hyperlinks in an external browser
        function openHyperlink(e) {
            e.preventDefault();
            e.stopPropagation();
            const url = e.target.href;
            console.log("Opening external link using _system", url);
            window.open(url, '_system');
        }
        if(window.isCrosswalk) {
            console.log("Crosswalk detected, rewriting links");
            var links = shadowRoot.querySelectorAll("A");
            var domainRegex = /^https?:\/\/((?:[\w\d-]+\.)+[\w\d]{2,})/i;
            for(var i = 0; i < links.length; i++) {
                if(domainRegex.test(links[i].href)) {
                    links[i].addEventListener("click", openHyperlink);
                }
            }
        } else {
            console.log("Not crosswalk, no need to rewrite links");
        }
    };

    AboutBoxProto.showPage = function(page) {
        this.setOverlayVisibility(true);
        this.swipePages.gotoPage(page);
    }

    AboutBoxProto.showNetworkError = function(error) {
        this.setOverlayVisibility(true);
        this.swipePages.gotoPage("pageNetworkError");
        this.querySelector("#networkErrorReason").innerHTML = error;
    }

    AboutBoxProto.setOverlayVisibility = function(state) {
        if(state) {
            this.querySelector("#overlay").style.display = "block";
        } else {
            this.querySelector("#overlay").style.display = "none";
        }
    }

    AboutBoxProto.addCallback = function(eventStr, callback) {
        this.eventListeners[eventStr].push(callback);
    }

    AboutBoxProto.dispatchCallback = function(eventStr) {
        var argsRest = Array.prototype.slice.call(arguments, 1);
        for(var i = 0; i < this.eventListeners[eventStr].length; i++) {
            this.eventListeners[eventStr][i].apply(null, argsRest);
        }
    }

    var AboutBox = document.registerElement('about-box', {prototype: AboutBoxProto});
})((document._currentScript || document.currentScript).ownerDocument);
</script>