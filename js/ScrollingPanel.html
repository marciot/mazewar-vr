<!--
ScrollingPanel.html
Copyright (C) 2016 Marcio Teixeira

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->

<template id="ScrollingPanelTemplate">
	<style>
		.scrolling-window.rounded {
			border-radius: 1em;
		}

		.scrolling-window.inset-from-window {
			position:      fixed;
			top:           2em;
			bottom:        2em;
			left:          2em;
			right:         2em;
		}

		.scrolling-window {
			position:      relative;
			padding:       10px;
			overflow:      hidden;
		}

		.scrolling-window-content {
			position:       absolute;
			overflow:       auto;
			padding-bottom: 5em;
		}

		.scrolling-window-no-inset {
			top:            0px;
			right:          0px;
			bottom:         0px;
			left:           0px;
		}

		.scrolling-window-inset {
			top:            15px;
			right:          10px;
			bottom:         15px;
			left:           15px;
			padding:        5px 10px;
		}

		/* Fancy fade-out decoration for scrolling text. This works
		 * by superimposing a gradient above and below DIV.fade-effect
		*/

		.scrolling-window .fade-effect {
			position:       absolute;
		}

		.scrolling-window.fadeaway .fade-effect-top, .scrolling-window.fadeaway .fade-effect-bottom {
			position:       absolute;
			left:           0;
			right:          17px;
			height:         50px;
			pointer-events: none;
		}

		.scrolling-window.fadeaway .fade-effect-top {
			top:             0;
		}
		.scrolling-window.fadeaway .fade-effect-bottom {
			bottom:          0;
		}

		/* Color schemes */

		.scrolling-window.darken {
			background:      rgba(0,0,0,0.8);
			color:           white;
		}

		.scrolling-window.fadeaway.darken {
			color:           white;
			background:      black;
			opacity:         0.8;
		}

		.scrolling-window.darken .fade-effect-top {
			background:      linear-gradient(rgba(0,0,0,1), rgba(255,255,255,0));
		}

		.scrolling-window.darken .fade-effect-bottom {
			background:      linear-gradient(rgba(255,255,255,0),rgba(0,0,0,1));
		}
	</style>
	<div class="scrolling-window">
		<div class="fade-effect scrolling-window-inset">
			<div class="scrolling-window-content scrolling-window-no-inset">
			<content></content>
			</div>
			<div class="fade-effect-top"></div>
			<div class="fade-effect-bottom"></div>
		</div>
	</div>
</template>

<script>
(function (thisDoc) {
	/* The following function provides a fallback
	 * when createShadowRoot does not exist or
	 * is not desired.
	 */
	function getShadowRoot(el, clone, fakeIt) {
		if(el.createShadowRoot && !el.classList.contains("noShadowRoot")) {
			return el.createShadowRoot();
		} else {
			var oldParent = el;
			var newParent = clone.querySelector("content").parentNode;
			while (oldParent.firstChild) newParent.appendChild(oldParent.firstChild);
			return el;
		}
	}

    var ScrollingPanelProto = Object.create(HTMLElement.prototype);

	ScrollingPanelProto.createdCallback = function() {
		var t = thisDoc.getElementById('ScrollingPanelTemplate');
		var clone = document.importNode(t.content, true);
		var shadowRoot = getShadowRoot(this, clone);
		shadowRoot.appendChild(clone);

		/* Copy class names from shadow host to shadow root */
		var el = shadowRoot.querySelector(".scrolling-window");
		el.classList.add.apply(el.classList, this.classList);
	};

	document.registerElement('scrolling-panel', {prototype: ScrollingPanelProto});

})((document._currentScript || document.currentScript).ownerDocument);
</script>
